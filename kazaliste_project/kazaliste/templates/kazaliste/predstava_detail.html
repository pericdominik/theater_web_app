{% extends "kazaliste/base.html" %}
{% load static %}

{% block title %}{{ predstava.title }}{% endblock %}

{% block content %}
<div class="row g-4">

  <div class="col-md-5">
    <div class="card shadow-sm">
        <img src="{{ predstava.image.url }}" class="card-img-top" alt="{{ predstava.title }}">

      <div class="card-body">
        <h5 class="card-title mb-2">{{ predstava.title }}</h5>

        <div class="d-flex align-items-center gap-2 mb-3">
          <span class="badge text-bg-secondary">Trajanje: {{ predstava.duration_minutes }} min</span>
          <span class="badge text-bg-info">Dob: {{ predstava.age_min }}+</span>
          {% if not predstava.is_active %}
            <span class="badge text-bg-warning">Neaktivno</span>
          {% endif %}
        </div>

        <span>
          {% if user_liked %}
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="red" class="bi bi-heart-fill" viewBox="0 0 16 16">
              <path d="M8 1.314C12.438-3.248 23.534 4.735 8 15-7.534 4.736 3.562-3.248 8 1.314z"/>
            </svg>
          {% else %}
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="gray" class="bi bi-heart" viewBox="0 0 16 16">
              <path d="m8 2.748-.717-.737C5.6.281 2.514.878 1.4 3.053c-.523 1.023-.641 2.5.314 4.385.92 1.815 2.834 3.989 6.286 6.357 3.452-2.368 5.365-4.542 6.286-6.357.955-1.886.838-3.362.314-4.385C13.486.878 10.4.28 8.717 2.01zM8 15C-7.333 4.868 3.279-3.04 7.824 1.143q.09.083.176.171a3 3 0 0 1 .176-.17C12.72-3.042 23.333 4.867 8 15"/>
            </svg>
            {% endif %}
            <span class="ms-1">{{ like_count|default:0 }}</span>
        </span>

          {% if user.is_authenticated %}
            {% if user_liked %}
              <a class="btn btn-outline-danger btn-sm" href="{% url 'predstava_like_remove' predstava.pk %}">Ukloni lajk</a>
            {% else %}
              <a class="btn btn-outline-primary btn-sm" href="{% url 'predstava_like_add' predstava.pk %}">Lajkaj</a>
            {% endif %}
          {% else %}
            <a class="btn btn-outline-secondary btn-sm" href="{% url 'login' %}"> Prijavi se za lajk</a>
          {% endif %}
        </div>
      </div>
    </div>

  <div class="col-md-7">

    <div class="card shadow-sm mb-4">
      <div class="card-header"><strong>Opis predstave</strong></div>
      <div class="card-body">
        <p class="mb-0">{{ predstava.description|linebreaks|default:"Nema opisa." }}</p>
      </div>
    </div>

    <div class="card shadow-sm mb-4">
      <div class="card-header"><strong>Nadolazeći termini</strong></div>
      <div class="card-body p-0">
        {% if upcoming %}
          <table class="table mb-0">
            <thead>
              <tr>
                <th style="width:40%;">Datum</th>
                <th style="width:30%;">Vrijeme</th>
                <th>Dvorana</th>
              </tr>
            </thead>
            <tbody>
              {% for t in upcoming %}
                <tr>
                  <td>{{ t.date|date:"d.m.Y." }}</td>
                  <td>{{ t.time|time:"H:i" }}</td>
                  <td>{{ t.dvorana }}</td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
        {% else %}
          <div class="p-3"><em>Trenutno nema najavljenih termina.</em></div>
        {% endif %}
      </div>
    </div>

    <div class="card shadow-sm">
      <div class="card-header"><strong>Komentari</strong></div>
      <div class="card-body">
        {% if comments %}
          <ul class="list-group list-group-flush mb-3">
            {% for c in comments %}
              <li class="list-group-item">
                <div class="d-flex justify-content-between">
                  <strong>{{ c.user.get_full_name|default:c.user.username }}</strong>
                  <small class="text-muted">{{ c.created_at|date:"d.m.Y. H:i" }}</small>
                </div>
                <div>{{ c.text|linebreaks }}</div>
              </li>
            {% endfor %}
          </ul>
        {% else %}
          <p class="text-muted">Nema komentara.</p>
        {% endif %}

        {% if user.is_authenticated %}
          <form method="post" class="mt-3">
            {% csrf_token %}
            {{ form.as_p }}
            <button class="btn btn-primary btn-sm">Pošalji komentar</button>
          </form>
        {% else %}
          <a class="btn btn-outline-secondary btn-sm" href="{% url 'login' %}">
            Prijavi se za ostavljanje komentara
          </a>
        {% endif %}
      </div>
    </div>
    <div class="text-end mt-4">
        <a href="{% url 'predstave_list' %}" class="btn btn-secondary">Natrag na popis predstava</a>
    </div>
  </div>
</div>

{% endblock %}