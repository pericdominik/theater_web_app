{% extends "kazaliste/base.html" %}

{% block title %}Moj profil{% endblock %}

{% block content %}
<div class="container my-4">

  <div class="row g-4 mb-4">
    <div class="col-md-6">
      <div class="card shadow-sm h-100">
        <div class="card-header"><strong>Osobni podaci</strong></div>
        <div class="card-body">
          <p><strong>Ime:</strong> {{ user_obj.first_name|default:"—" }}</p>
          <p><strong>Prezime:</strong> {{ user_obj.last_name|default:"—" }}</p>
          <p><strong>E-mail:</strong> {{ user_obj.email|default:"—" }}</p>
        </div>
      </div>
    </div>

     <div class="col-md-6">
      <div class="card shadow-sm h-100" id="kontakt">
        <div class="card-header d-flex justify-content-between align-items-center">
          <strong>Kontakt</strong>
          {% if not edit %}
            <a href="{% url 'profile' %}?edit=1#kontakt" class="btn btn-sm btn-outline-primary">Uredi</a>
          {% endif %}
        </div>

        <div class="card-body">
          {% if not edit %}
            <p><strong>Telefon:</strong> {{ account.phone|default:"—" }}</p>
            <p><strong>Država:</strong> {{ account.country|default:"—" }}</p>
          {% else %}
            <form method="post" action="{% url 'profile' %}?edit=1#kontakt">
              {% csrf_token %}
              {{ form.as_p }}
              <div class="d-flex gap-2">
                <button type="submit" class="btn btn-primary btn-sm">Spremi</button>
                <a href="{% url 'profile' %}#kontakt" class="btn btn-outline-secondary btn-sm">Odustani</a>
              </div>
            </form>
          {% endif %}
        </div>
      </div>
    </div>
  </div>

  <div class="row g-4">
    <div class="col-md-6">

      <div class="card shadow-sm mb-4">
        <div class="card-header"><strong>Moji komentari</strong></div>
        <div class="card-body">
          {% if comments %}
            <ul class="list-group list-group-flush">
              {% for c in comments %}
                <li class="list-group-item">
                  <a href="{% url 'predstava_detail' c.predstava.pk %}">{{ c.predstava.title }}</a>
                  — {{ c.created_at|date:"d.m.Y H:i" }}
                  {% if c.approved %}
                    <span class="badge bg-success">Odobren</span>
                  {% else %}
                    <span class="badge bg-warning text-dark">Čeka odobrenje</span>
                  {% endif %}
                  <div>{{ c.text|linebreaks }}</div>
                </li>
              {% endfor %}
            </ul>
          {% else %}
            <p class="text-muted mb-0"><em>Još nemaš komentara.</em></p>
          {% endif %}
        </div>
      </div>

      <div class="card shadow-sm">
        <div class="card-header"><strong>Moje lajkane predstave</strong></div>
        <div class="card-body">
          {% if likes %}
            <ul class="list-group list-group-flush">
              {% for l in likes %}
                <li class="list-group-item">
                  <a href="{% url 'predstava_detail' l.predstava.pk %}">{{ l.predstava.title }}</a>
                </li>
              {% endfor %}
            </ul>
          {% else %}
            <p class="text-muted mb-0"><em>Nemaš lajkane predstave.</em></p>
          {% endif %}
        </div>
      </div>

    </div>

    <div class="col-md-6">
      <div class="card shadow-sm">
        <div class="card-header"><strong>Moje rezervacije</strong></div>
        <div class="card-body p-0">
          {% if reservations %}
            <table class="table mb-0">
              <thead class="table-light">
                <tr>
                  <th>Predstava</th>
                  <th>Količina</th>
                  <th>Status</th>
                  <th>Kreirano</th>
                </tr>
              </thead>
              <tbody>
                {% for r in reservations %}
                  <tr>
                    <td><a href="{% url 'predstava_detail' r.predstava.pk %}">{{ r.predstava.title }}</a></td>
                    <td>{{ r.quantity }}</td>
                    <td>
                      {% if r.status == 'new' %}
                        <span class="badge bg-info text-dark">Nova</span>
                      {% elif r.status == 'closed' %}
                        <span class="badge bg-secondary">Zatvorena</span>
                      {% else %}
                        {{ r.status }}
                      {% endif %}
                    </td>
                    <td>{{ r.created_at|date:"d.m.Y H:i" }}</td>
                  </tr>
                {% endfor %}
              </tbody>
            </table>
          {% else %}
            <p class="text-muted m-3"><em>Nema rezervacija vezanih uz tvoj e-mail.</em></p>
          {% endif %}
        </div>
      </div>
    </div>
  </div>

</div>
{% endblock %}